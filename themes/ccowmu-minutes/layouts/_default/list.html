{{ define "main" }}
<div class="minutes-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{{ .Site.Params.mainSiteURL }}">CCaWMU</a> / Minutes
    </nav>
    
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="main-title">Meeting Minutes</h1>
        <p class="hero-subtitle">Archive of Computer Club @ WMU meetings</p>
    </div>
    
    <!-- Search Container -->
    <div class="search-container">
        <input 
            type="text" 
            id="search-input" 
            class="search-input" 
            placeholder="Search minutes by date, topic, or content..."
            autocomplete="off"
        >
        <div class="search-stats" id="search-stats">
            Showing {{ len .Pages }} of {{ len .Pages }} minutes
        </div>
    </div>
    
    <!-- Controls -->
    <div class="controls-container">
        <!-- Year Filters -->
        <div class="year-filters">
            <a href="#" class="year-filter active" data-year="all">All Years</a>
            {{ range .Site.Data.years }}
            <a href="#" class="year-filter" data-year="{{ . }}">{{ . }}</a>
            {{ end }}
        </div>
        
        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="view-btn active" data-view="grid">Grid View</button>
            <button class="view-btn" data-view="list">List View</button>
        </div>
    </div>
    
    <!-- Minutes Grid View -->
    <div class="minutes-grid active" id="minutes-grid">
        {{ range .Pages.ByDate.Reverse }}
        <article class="minute-card" data-year="{{ .Date.Year }}" data-search-content="{{ .Title }} {{ .Summary }} {{ .Date.Format "2006-01-02" }}">
            <a href="{{ .Permalink }}" class="card-link">
                <h2 class="minute-title">{{ .Title }}</h2>
                <div class="minute-date">{{ .Date.Format "January 2, 2006" }}</div>
                <div class="minute-preview">{{ .Summary | truncate 150 }}</div>
            </a>
        </article>
        {{ end }}
    </div>
    
    <!-- Minutes List View -->
    <div class="minutes-list" id="minutes-list">
        {{ range .Pages.ByDate.Reverse }}
        <article class="minute-list-item" data-year="{{ .Date.Year }}" data-search-content="{{ .Title }} {{ .Summary }} {{ .Date.Format "2006-01-02" }}">
            <div>
                <a href="{{ .Permalink }}" class="minute-title">{{ .Title }}</a>
                <div class="minute-preview">{{ .Summary | truncate 100 }}</div>
            </div>
            <div class="minute-date">{{ .Date.Format "Jan 2, 2006" }}</div>
        </article>
        {{ end }}
    </div>
    
    <!-- No Results Message -->
    <div class="no-results" id="no-results" style="display: none;">
        <h3>No minutes found</h3>
        <p>Try adjusting your search terms or year filter.</p>
    </div>
</div>
{{ end }}

{{ define "scripts" }}
<!-- Fuse.js for fuzzy search -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const searchStats = document.getElementById('search-stats');
    const minutesGrid = document.getElementById('minutes-grid');
    const minutesList = document.getElementById('minutes-list');
    const noResults = document.getElementById('no-results');
    const yearFilters = document.querySelectorAll('.year-filter');
    const viewButtons = document.querySelectorAll('.view-btn');
    
    let allMinutes = [];
    let filteredMinutes = [];
    let currentView = 'grid';
    let currentYear = 'all';
    let fuse;
    
    // Initialize search data
    const minutes = document.querySelectorAll('.minute-card, .minute-list-item');
    minutes.forEach(minute => {
        allMinutes.push({
            element: minute,
            title: minute.querySelector('.minute-title').textContent,
            content: minute.dataset.searchContent,
            year: minute.dataset.year
        });
    });
    
    filteredMinutes = [...allMinutes];
    
    // Initialize Fuse.js for fuzzy search
    fuse = new Fuse(allMinutes, {
        keys: ['title', 'content'],
        threshold: 0.3,
        includeScore: true,
        includeMatches: true
    });
    
    // Search functionality
    searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();
        
        if (query === '') {
            filteredMinutes = allMinutes.filter(minute => 
                currentYear === 'all' || minute.year === currentYear
            );
        } else {
            const results = fuse.search(query);
            filteredMinutes = results
                .filter(result => currentYear === 'all' || result.item.year === currentYear)
                .map(result => result.item);
        }
        
        updateDisplay();
        updateStats();
    });
    
    // Year filter functionality
    yearFilters.forEach(filter => {
        filter.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active state
            yearFilters.forEach(f => f.classList.remove('active'));
            this.classList.add('active');
            
            currentYear = this.dataset.year;
            
            // Re-apply search with new year filter
            const query = searchInput.value.trim();
            if (query === '') {
                filteredMinutes = allMinutes.filter(minute => 
                    currentYear === 'all' || minute.year === currentYear
                );
            } else {
                const results = fuse.search(query);
                filteredMinutes = results
                    .filter(result => currentYear === 'all' || result.item.year === currentYear)
                    .map(result => result.item);
            }
            
            updateDisplay();
            updateStats();
        });
    });
    
    // View toggle functionality
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Update active state
            viewButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            currentView = this.dataset.view;
            
            if (currentView === 'grid') {
                minutesGrid.classList.add('active');
                minutesList.classList.remove('active');
            } else {
                minutesGrid.classList.remove('active');
                minutesList.classList.add('active');
            }
        });
    });
    
    function updateDisplay() {
        // Hide all minutes
        allMinutes.forEach(minute => {
            minute.element.style.display = 'none';
        });
        
        // Show filtered minutes
        if (filteredMinutes.length === 0) {
            noResults.style.display = 'block';
            minutesGrid.style.display = 'none';
            minutesList.style.display = 'none';
        } else {
            noResults.style.display = 'none';
            if (currentView === 'grid') {
                minutesGrid.style.display = 'grid';
                minutesList.style.display = 'none';
            } else {
                minutesGrid.style.display = 'none';
                minutesList.style.display = 'block';
            }
            
            filteredMinutes.forEach(minute => {
                minute.element.style.display = currentView === 'grid' ? 'block' : 'flex';
            });
        }
    }
    
    function updateStats() {
        const total = allMinutes.filter(minute => 
            currentYear === 'all' || minute.year === currentYear
        ).length;
        
        searchStats.textContent = `Showing ${filteredMinutes.length} of ${total} minutes`;
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Focus search on '/' key
        if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
            e.preventDefault();
            searchInput.focus();
        }
        
        // Clear search on Escape
        if (e.key === 'Escape') {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
        }
    });
    
    // Initialize display
    updateDisplay();
    updateStats();
});
</script>
{{ end }}
